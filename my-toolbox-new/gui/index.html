<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è„šæœ¬å·¥å…·ç®±</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- é¡¶éƒ¨å·¥å…·æ  -->
        <header class="app-header">
            <div class="header-left">
                <h1 class="app-title">ğŸš€ è„šæœ¬å·¥å…·ç®±</h1>
            </div>
            <div class="header-center">
                <div class="search-container">
                    <input type="text" class="search-input" id="search-input" placeholder="æœç´¢è„šæœ¬...">
                    <span class="search-icon">ğŸ”</span>
                </div>
            </div>
            <div class="header-right">
                <button class="btn btn-primary" id="refresh-btn">
                    <span class="btn-icon">ğŸ”„</span>
                    åˆ·æ–°
                </button>
                <button class="btn btn-secondary" id="venv-management-btn">
                    <span class="btn-icon">ğŸ“¦</span>
                    ç¯å¢ƒ
                </button>
            </div>
        </header>

        <div class="main-container">
            <!-- åˆ†ç±»ä¾§è¾¹æ  -->
            <aside class="sidebar">
                <div class="category-header">
                    <h3>åˆ†ç±»</h3>
                    <button class="btn btn-small" id="add-category-btn" title="æ·»åŠ åˆ†ç±»">+</button>
                </div>
                <div class="category-list" id="category-list">
                    <!-- åˆ†ç±»å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </aside>

            <!-- ä¸»å†…å®¹åŒºåŸŸ -->
            <main class="main-content">
                <div class="scripts-grid" id="scripts-grid">
                    <!-- è„šæœ¬å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </main>
        </div>

        <!-- æ¨¡æ€å¯¹è¯æ¡† - å‚æ•°é…ç½® -->
        <div id="modal-overlay" class="modal-overlay" style="display: none;">
            <div class="modal">
                <div class="modal-header">
                    <h3 id="modal-title">é…ç½®å‚æ•°</h3>
                    <button class="modal-close" id="modal-close">&times;</button>
                </div>
                <div class="modal-body" id="modal-body">
                    <!-- å‚æ•°è¡¨å•å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="modal-cancel">å–æ¶ˆ</button>
                    <button class="btn btn-primary" id="modal-execute">æ‰§è¡Œ</button>
                </div>
            </div>
        </div>

        <!-- ç»ˆç«¯è¾“å‡ºè§†å›¾ -->
        <div id="terminal-view" class="terminal-view" style="display: none;">
            <div class="terminal-header">
                <h3>ç»ˆç«¯è¾“å‡º</h3>
                <button class="btn btn-danger" id="terminal-kill-btn" style="margin-right: 10px;">ğŸ›‘ ç»ˆæ­¢ä»»åŠ¡</button>
                <button class="btn btn-secondary" id="terminal-close">å…³é—­</button>
            </div>
            <div class="terminal-output" id="terminal-output">
                <!-- è¾“å‡ºå†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
            </div>
        </div>
    </div>

    <!-- è™šæ‹Ÿç¯å¢ƒç®¡ç†æ¨¡æ€å¯¹è¯æ¡† -->
    <div id="venv-modal-overlay" class="modal-overlay" style="display: none;">
        <div id="venv-modal" class="modal">
            <div class="modal-header">
                <h3>ğŸ“¦ è™šæ‹Ÿç¯å¢ƒç®¡ç†</h3>
                <button class="modal-close" id="venv-modal-close">&times;</button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <div class="venv-modal-content">
                    <!-- å·¦ä¾§ï¼šè™šæ‹Ÿç¯å¢ƒåˆ—è¡¨ -->
                    <div class="venv-list-panel">
                        <div class="venv-list-header">
                            <button class="btn btn-primary" id="add-venv-btn">+ åˆ›å»ºæ–°ç¯å¢ƒ</button>
                        </div>
                        <div class="venv-list" id="venv-list">
                            <!-- JS åŠ¨æ€ç”Ÿæˆç¯å¢ƒåˆ—è¡¨ -->
                        </div>
                    </div>
                    <!-- å³ä¾§ï¼šç¯å¢ƒè¯¦æƒ… -->
                    <div class="venv-details-panel">
                        <div class="venv-details-header">
                            <h4 id="venv-details-title">é€‰æ‹©ä¸€ä¸ªç¯å¢ƒ</h4>
                            <button class="btn btn-secondary" id="add-dependency-btn">+ æ·»åŠ ä¾èµ–</button>
                        </div>
                        <div class="venv-packages-list" id="venv-packages-list">
                            <!-- JS åŠ¨æ€ç”ŸæˆåŒ…åˆ—è¡¨ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- è¿›åº¦æ˜¾ç¤ºæ¨¡æ€å¯¹è¯æ¡† -->
    <div id="progress-modal-overlay" class="modal-overlay" style="display: none; background: rgba(0, 0, 0, 0.4);">
        <div class="modal" style="max-width: 450px;">
            <div id="progress-modal-log" class="modal-body" style="background-color: #1e1e1e; color: #d4d4d4; font-family: 'Courier New', monospace; max-height: 300px; overflow-y: auto;">
                <!-- è¿›åº¦æ—¥å¿—å°†åŠ¨æ€æ’å…¥æ­¤å¤„ -->
            </div>
        </div>
    </div>

    <script type="module" src="script.js"></script>
    <script type="module" src="venv_ui.js"></script>
    <script>
        // åœ¨é¡µé¢å¸è½½å‰ä¿å­˜å½“å‰çš„æ’åºçŠ¶æ€
        window.addEventListener('beforeunload', async function() {
            // ç­‰å¾…pywebview APIå‡†å¤‡å°±ç»ªï¼Œå¹¶ä¸”æœ‰è„šæœ¬å·¥å…·ç®±å®ä¾‹
            if (window.pywebview && window.pywebview.api && window.scriptToolbox) {
                try {
                    // ä½¿ç”¨åº”ç”¨å®ä¾‹çš„ä¿å­˜æ–¹æ³•
                    await window.scriptToolbox.saveCurrentState();
                } catch (error) {
                    console.error('ä¿å­˜æ’åºçŠ¶æ€æ—¶å‡ºé”™:', error);
                }
            }
        });
    </script>
</body>
</html>